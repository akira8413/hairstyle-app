<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒªã‚»ãƒƒãƒˆç”»åƒç”Ÿæˆ - ç®¡ç†ç”»é¢</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { margin-bottom: 20px; font-size: 24px; }
        h2 { margin: 20px 0 10px; font-size: 18px; color: #666; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }
        .preset-card {
            background: white;
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .preset-card img {
            width: 72px;
            height: 72px;
            border-radius: 8px;
            object-fit: cover;
            background: #eee;
        }
        .preset-card .placeholder {
            width: 72px;
            height: 72px;
            border-radius: 8px;
            background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            margin: 0 auto;
        }
        .preset-card .name {
            font-size: 12px;
            margin-top: 6px;
            color: #333;
        }
        .preset-card button {
            margin-top: 8px;
            padding: 6px 12px;
            font-size: 11px;
            border: none;
            border-radius: 6px;
            background: #FF6B8A;
            color: white;
            cursor: pointer;
        }
        .preset-card button:hover { background: #e55a78; }
        .preset-card button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .preset-card .status {
            font-size: 10px;
            margin-top: 4px;
            color: #666;
        }
        .preset-card.generating { opacity: 0.7; }
        .preset-card.done .placeholder { background: #4CAF50; color: white; }
        .actions {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        .actions button {
            padding: 12px 24px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .actions .primary {
            background: linear-gradient(135deg, #FF6B8A, #FF8E53);
            color: white;
        }
        .actions .secondary {
            background: #e0e0e0;
            color: #333;
        }
        .log {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log .error { color: #f66; }
        .log .success { color: #6f6; }
    </style>
</head>
<body>
    <h1>ğŸ¨ ãƒ—ãƒªã‚»ãƒƒãƒˆç”»åƒç”Ÿæˆ</h1>

    <div class="actions">
        <button class="primary" onclick="generateAll()">å…¨ã¦ç”Ÿæˆ</button>
        <button class="secondary" onclick="location.reload()">æ›´æ–°</button>
    </div>

    <h2>ğŸ‘¨ ãƒ¡ãƒ³ã‚º</h2>
    <div class="grid" id="mensGrid"></div>

    <h2>ğŸ‘© ãƒ¬ãƒ‡ã‚£ãƒ¼ã‚¹</h2>
    <div class="grid" id="ladiesGrid"></div>

    <div class="log" id="log"></div>

    <script>
        const PRESETS = {
            mens: [
                { id: 'none', name: 'ãªã—' },
                { id: 'short', name: 'ã‚·ãƒ§ãƒ¼ãƒˆ' },
                { id: 'twoblock', name: 'ãƒ„ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯' },
                { id: 'mash', name: 'ãƒãƒƒã‚·ãƒ¥' },
                { id: 'center', name: 'ã‚»ãƒ³ã‚¿ãƒ¼ãƒ‘ãƒ¼ãƒˆ' },
                { id: 'wolf', name: 'ã‚¦ãƒ«ãƒ•' },
                { id: 'perm', name: 'ãƒ‘ãƒ¼ãƒ' },
                { id: 'long', name: 'ãƒ­ãƒ³ã‚°' },
            ],
            ladies: [
                { id: 'none', name: 'ãªã—' },
                { id: 'short', name: 'ã‚·ãƒ§ãƒ¼ãƒˆ' },
                { id: 'bob', name: 'ãƒœãƒ–' },
                { id: 'lob', name: 'ãƒ­ãƒ–' },
                { id: 'medium', name: 'ãƒŸãƒ‡ã‚£ã‚¢ãƒ ' },
                { id: 'layer', name: 'ãƒ¬ã‚¤ãƒ¤ãƒ¼' },
                { id: 'long', name: 'ãƒ­ãƒ³ã‚°' },
                { id: 'wave', name: 'ã‚¦ã‚§ãƒ¼ãƒ–' },
            ]
        };

        function log(msg, type = 'info') {
            const logEl = document.getElementById('log');
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(line);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function renderGrid(gender, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            PRESETS[gender].forEach(preset => {
                const card = document.createElement('div');
                card.className = 'preset-card';
                card.id = `card-${gender}-${preset.id}`;

                const imgPath = `/images/presets/${gender}/${preset.id}.png`;

                card.innerHTML = `
                    <div class="placeholder" id="thumb-${gender}-${preset.id}">
                        <img src="${imgPath}" alt="${preset.name}"
                             onerror="this.parentElement.innerHTML='æœªç”Ÿæˆ'">
                    </div>
                    <div class="name">${preset.name}</div>
                    <button onclick="generate('${gender}', '${preset.id}')"
                            id="btn-${gender}-${preset.id}">
                        ç”Ÿæˆ
                    </button>
                    <div class="status" id="status-${gender}-${preset.id}"></div>
                `;

                container.appendChild(card);
            });
        }

        async function generate(gender, presetId) {
            const card = document.getElementById(`card-${gender}-${presetId}`);
            const btn = document.getElementById(`btn-${gender}-${presetId}`);
            const status = document.getElementById(`status-${gender}-${presetId}`);
            const thumb = document.getElementById(`thumb-${gender}-${presetId}`);

            card.classList.add('generating');
            btn.disabled = true;
            status.textContent = 'ç”Ÿæˆä¸­...';
            log(`${gender}/${presetId} ç”Ÿæˆé–‹å§‹...`);

            try {
                const response = await fetch(`/api/v1/admin/generate-preset/${gender}/${presetId}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed');
                }

                // ç”»åƒã‚’æ›´æ–°
                thumb.innerHTML = `<img src="${data.image}" alt="${presetId}">`;
                card.classList.add('done');
                status.textContent = 'å®Œäº†';
                log(`${gender}/${presetId} ç”Ÿæˆå®Œäº†!`, 'success');

            } catch (error) {
                status.textContent = 'ã‚¨ãƒ©ãƒ¼';
                log(`${gender}/${presetId} ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                card.classList.remove('generating');
                btn.disabled = false;
            }
        }

        async function generateAll() {
            log('å…¨ãƒ—ãƒªã‚»ãƒƒãƒˆç”Ÿæˆé–‹å§‹...');

            for (const gender of ['mens', 'ladies']) {
                for (const preset of PRESETS[gender]) {
                    if (preset.id === 'none') continue;
                    await generate(gender, preset.id);
                    // APIåˆ¶é™ã‚’é¿ã‘ã‚‹ãŸã‚å°‘ã—å¾…æ©Ÿ
                    await new Promise(r => setTimeout(r, 2000));
                }
            }

            log('å…¨ãƒ—ãƒªã‚»ãƒƒãƒˆç”Ÿæˆå®Œäº†!', 'success');
        }

        // åˆæœŸåŒ–
        renderGrid('mens', 'mensGrid');
        renderGrid('ladies', 'ladiesGrid');
        log('ç®¡ç†ç”»é¢ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    </script>
</body>
</html>
